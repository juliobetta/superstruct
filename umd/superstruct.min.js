!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(r.Superstruct={})}(this,function(r){"use strict";var t=function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),n=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},a=function(r,t){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?r:t},o=function(){return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return function(r,t){var e=[],n=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(n=(i=u.next()).done)&&(e.push(i.value),!t||e.length!==t);n=!0);}catch(r){a=!0,o=r}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return e}(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(r){function n(r){t(this,n);var e=n.format(r),o=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e)),i=r.data,u=r.path,c=r.value,s=r.reason,f=r.type,v=r.errors,l=void 0===v?[]:v;return o.data=i,o.path=u,o.value=c,o.reason=s,o.type=f,o.errors=l,l.length||l.push(o),Error.captureStackTrace?Error.captureStackTrace(o,o.constructor):o.stack=(new Error).stack,o}return function(r,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)}(n,TypeError),e(n,null,[{key:"format",value:function(r){var t=r.type,e=r.path,n=r.value;return"Expected a value of type `"+t+"`"+(e.length?" for `"+e.join(".")+"`":"")+" but received `"+JSON.stringify(n)+"`."}}]),n}(),u=Object.prototype.toString,c=function(r){if(void 0===r)return"undefined";if(null===r)return"null";var t=typeof r;if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return"GeneratorFunction"===s(r)?"generatorfunction":"function";if(function(r){return Array.isArray?Array.isArray(r):r instanceof Array}(r))return"array";if(function(r){if(r.constructor&&"function"==typeof r.constructor.isBuffer)return r.constructor.isBuffer(r);return!1}(r))return"buffer";if(function(r){try{if("number"==typeof r.length&&"function"==typeof r.callee)return!0}catch(r){if(-1!==r.message.indexOf("callee"))return!0}return!1}(r))return"arguments";if(function(r){return r instanceof Date||"function"==typeof r.toDateString&&"function"==typeof r.getDate&&"function"==typeof r.setDate}(r))return"date";if(function(r){return r instanceof Error||"string"==typeof r.message&&r.constructor&&"number"==typeof r.constructor.stackTraceLimit}(r))return"error";if(function(r){return r instanceof RegExp||"string"==typeof r.flags&&"boolean"==typeof r.ignoreCase&&"boolean"==typeof r.multiline&&"boolean"==typeof r.global}(r))return"regexp";switch(s(r)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(r){return"function"==typeof r.throw&&"function"==typeof r.return&&"function"==typeof r.next}(r))return"generator";switch(t=u.call(r)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function s(r){return r.constructor?r.constructor.name:null}var f="@@__STRUCT__@@",v="@@__KIND__@@";function l(r){return!(!r||!r[f])}function d(r,t){return"function"==typeof r?r(t):r}var p=function r(e,n,a){t(this,r),this.name=e,this.type=n,this.validate=a};function y(r,t,e){if(l(r))return r[v];if(r instanceof p)return r;switch(c(r)){case"array":return r.length>1?E(r,t,e):w(r,t,e);case"function":return b(r,t,e);case"object":return m(r,t,e);case"string":var n=!0,a=void 0;if(r.endsWith("?")&&(n=!1,r=r.slice(0,-1)),r.includes("|"))a=O(r.split(/\s*\|\s*/g),t,e);else if(r.includes("&")){a=S(r.split(/\s*&\s*/g),t,e)}else a=j(r,t,e);return n||(a=g(a,void 0,e)),a}throw new Error("A schema definition must be an object, array, string or function, but you passed: "+r)}function h(r,t,e){if("array"!==c(r))throw new Error("Enum structs must be defined as an array, but you passed: "+r);var n=r.map(function(r){try{return JSON.stringify(r)}catch(t){return String(r)}}).join(" | ");return new p("enum",n,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t);return r.includes(e)?[void 0,e]:[{data:e,path:[],value:e,type:n}]})}function b(r,t,e){if("function"!==c(r))throw new Error("Function structs must be defined as a function, but you passed: "+r);return new p("function","<function>",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),a=arguments[1],o=r(e,a),i={path:[],reason:null},u=void 0;switch(c(o)){case"boolean":u=o;break;case"string":u=!1,i.reason=o;break;case"object":u=!1,i=n({},i,o);break;default:throw new Error("Validator functions must return a boolean, an error reason string or an error reason object, but you passed: "+r)}return u?[void 0,e]:[n({type:"<function>",value:e,data:e},i)]})}function w(r,t,e){if("array"!==c(r)||1!==r.length)throw new Error("List structs must be defined as an array with a single element, but you passed: "+r);var n=j("array",void 0,e),a=y(r[0],void 0,e),i="["+a.type+"]";return new p("list",i,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),e=n.validate(r),u=o(e,2),c=u[0],s=u[1];if(c)return c.type=i,[c];r=s;for(var f=[],v=[],l=0;l<r.length;l++){var p=r[l],y=a.validate(p),h=o(y,2),b=h[0],w=h[1];b?(b.path=[l].concat(b.path),b.data=r,f.push(b)):v[l]=w}if(f.length){var m=f[0];return m.errors=f,[m]}return[void 0,v]})}function m(r,t,e){if("object"!==c(r))throw new Error("Object structs must be defined as an object, but you passed: "+r);var n=j("object",void 0,e),a=[],i={};for(var u in r){a.push(u);var s=y(r[u],void 0,e);i[u]=s}var f="{"+a.join()+"}";return new p("object",f,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),e=n.validate(r),a=o(e,1)[0];if(a)return a.type=f,[a];var u=[],c={},s=Object.keys(r),v=Object.keys(i);if(new Set(s.concat(v)).forEach(function(e){var n=r[e],a=i[e];if(void 0===n&&(n=d(t&&t[e],r)),a){var s=a.validate(n,r),f=o(s,2),v=f[0],l=f[1];if(v)return v.path=[e].concat(v.path),v.data=r,void u.push(v);(e in r||void 0!==l)&&(c[e]=l)}else{var p={data:r,path:[e],value:n};u.push(p)}}),u.length){var l=u[0];return l.errors=u,[l]}return[void 0,c]})}function g(r,t,e){return O([r,"undefined"],t,e)}function j(r,t,e){if("string"!==c(r))throw new Error("Scalar structs must be defined as a string, but you passed: "+r);var n=e.types[r];if("function"!==c(n))throw new Error('No struct validator function found for type "'+r+'".');var a=b(n,t),i=r;return new p("scalar",i,function(r){var t=a.validate(r),e=o(t,2),n=e[0],u=e[1];return n?(n.type=i,[n]):[void 0,u]})}function E(r,t,e){if("array"!==c(r))throw new Error("Tuple structs must be defined as an array, but you passed: "+r);var n=r.map(function(r){return y(r,void 0,e)}),a=j("array",void 0,e),i="["+n.map(function(r){return r.type}).join()+"]";return new p("tuple",i,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),e=a.validate(r),u=o(e,1)[0];if(u)return u.type=i,[u];for(var c=[],s=[],f=Math.max(r.length,n.length),v=0;v<f;v++){var l=n[v],p=r[v];if(l){var y=l.validate(p),h=o(y,2),b=h[0],w=h[1];b?(b.path=[v].concat(b.path),b.data=r,s.push(b)):c[v]=w}else{var m={data:r,path:[v],value:p};s.push(m)}}if(s.length){var g=s[0];return g.errors=s,[g]}return[void 0,c]})}function O(r,t,e){if("array"!==c(r))throw new Error("Union structs must be defined as an array, but you passed: "+r);var n=r.map(function(r){return y(r,void 0,e)}),a=n.map(function(r){return r.type}).join(" | ");return new p("union",a,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),e=[];for(var i of n){var u=i.validate(r),c=o(u,2),s=c[0],f=c[1];if(!s)return[void 0,f];e.push(s)}return e[0].type=a,e})}function S(r,t,e){if("array"!==c(r))throw new Error("Intersection structs must be defined as an array, but you passed: "+r);var n=r.map(function(r){return y(r,void 0,e)}),a=n.map(function(r){return r.type}).join(" & ");return new p("intersection",a,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t);for(var e of n){var i=e.validate(r),u=o(i,2),c=u[0],s=u[1];if(c)return c.type=a,[c];r=s}return[void 0,r]})}var k={any:y,dict:function(r,t,e){if("array"!==c(r)||2!==r.length)throw new Error("Dict structs must be defined as an array with two elements, but you passed: "+r);var a=j("object",void 0,e),i=y(r[0],void 0,e),u=y(r[1],void 0,e),s="dict<"+i.type+","+u.type+">";return new p("dict",s,function(r){var e=d(t);r=e?n({},e,r):r;var c=a.validate(r),f=o(c,1)[0];if(f)return f.type=s,[f];var v={},l=[];for(var p in r){var y=r[p],h=i.validate(p),b=o(h,2),w=b[0],m=b[1];if(w)w.path=[p].concat(w.path),w.data=r,l.push(w);else{p=m;var g=u.validate(y),j=o(g,2),E=j[0],O=j[1];E?(E.path=[p].concat(E.path),E.data=r,l.push(E)):v[p]=O}}if(l.length){var S=l[0];return S.errors=l,[S]}return[void 0,v]})},enum:h,enums:function(r,t,e){return w([h(r,void 0)],t,e)},function:b,instance:function(r,t,e){var n="instance<"+r.name+">";return new p("instance",n,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t);return e instanceof r?[void 0,e]:[{data:e,path:[],value:e,type:n}]})},interface:function(r,t,e){if("object"!==c(r))throw new Error("Interface structs must be defined as an object, but you passed: "+r);var a=[],i={};for(var u in r){a.push(u);var s=y(r[u],void 0,e);i[u]=s}var f="{"+a.join()+"}";return new p("interface",f,function(r){var e=d(t),a=[],u=r=e?n({},e,r):r;for(var c in i){var s=r[c],f=i[c];void 0===s&&(s=d(t&&t[c],r));var v=f.validate(s,r),l=o(v,2),p=l[0],y=l[1];p?(p.path=[c].concat(p.path),p.data=r,a.push(p)):(c in r||void 0!==y)&&(u[c]=y)}if(a.length){var h=a[0];return h.errors=a,[h]}return[void 0,u]})},lazy:function(r,t,e){if("function"!==c(r))throw new Error("Lazy structs must be defined as an function that returns a schema, but you passed: "+r);var n=void 0,a=void 0;return n=new p("lazy","lazy...",function(t){return a=r(),n.name=a.kind,n.type=a.type,n.validate=a.validate,n.validate(t)})},list:w,literal:function(r,t,e){var n="literal: "+JSON.stringify(r);return new p("literal",n,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t);return e===r?[void 0,e]:[{data:e,path:[],value:e,type:n}]})},object:m,optional:g,partial:function(r,t,e){if("object"!==c(r))throw new Error("Partial structs must be defined as an object, but you passed: "+r);var n=j("object",void 0,e),a=[],i={};for(var u in r){a.push(u);var s=y(r[u],void 0,e);i[u]=s}var f="{"+a.join()+",...}";return new p("partial",f,function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d(t),e=n.validate(r),a=o(e,1)[0];if(a)return a.type=f,[a];var u=[],c={};for(var s in i){var v=r[s],l=i[s];void 0===v&&(v=d(t&&t[s],r));var p=l.validate(v,r),y=o(p,2),h=y[0],b=y[1];h?(h.path=[s].concat(h.path),h.data=r,u.push(h)):(s in r||void 0!==b)&&(c[s]=b)}if(u.length){var w=u[0];return w.errors=u,[w]}return[void 0,c]})},scalar:j,tuple:E,union:O,intersection:S},A={any:function(r){return void 0!==r}};function _(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n({},A,r.types||{});function e(r,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l(r)&&(r=r.schema);var u=k.any(r,e,n({},a,{types:t}));function c(r){if(this instanceof c)throw new Error("The `Struct` creation function should not be used with the `new` keyword.");return c.assert(r)}return Object.defineProperty(c,f,{value:!0}),Object.defineProperty(c,v,{value:u}),c.kind=u.name,c.type=u.type,c.schema=r,c.defaults=e,c.options=a,c.assert=function(r){var t=u.validate(r),e=o(t,2),n=e[0],a=e[1];if(n)throw new i(n);return a},c.test=function(r){var t=u.validate(r);return!o(t,1)[0]},c.validate=function(r){var t=u.validate(r),e=o(t,2),n=e[0],a=e[1];return n?[new i(n)]:[void 0,a]},c}return Object.keys(k).forEach(function(r){var a=k[r];e[r]=function(r,o,i){return e(a(r,o,n({},i,{types:t})),o,i)}}),e}["arguments","array","boolean","buffer","date","error","float32array","float64array","function","generatorfunction","int16array","int32array","int8array","map","null","number","object","promise","regexp","set","string","symbol","uint16array","uint32array","uint8array","uint8clampedarray","undefined","weakmap","weakset"].forEach(function(r){A[r]=function(t){return c(t)===r}});var x=_();r.struct=x,r.superstruct=_,r.isStruct=l,r.StructError=i,Object.defineProperty(r,"__esModule",{value:!0})});
