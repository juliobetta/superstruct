!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(r.Superstruct={})}(this,function(r){"use strict";class t extends TypeError{static format(r){var{type:t,path:e,value:n}=r;return`Expected a value of type \`${t}\`${e.length?` for \`${e.join(".")}\``:""} but received \`${JSON.stringify(n)}\`.`}constructor(r){super(t.format(r));var{data:e,path:n,value:a,reason:o,type:i,errors:u=[]}=r;this.data=e,this.path=n,this.value=a,this.reason=o,this.type=i,this.errors=u,u.length||u.push(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack}}var e=Object.prototype.toString,n=function(r){if(void 0===r)return"undefined";if(null===r)return"null";var t=typeof r;if("boolean"===t)return"boolean";if("string"===t)return"string";if("number"===t)return"number";if("symbol"===t)return"symbol";if("function"===t)return"GeneratorFunction"===a(r)?"generatorfunction":"function";if(function(r){return Array.isArray?Array.isArray(r):r instanceof Array}(r))return"array";if(function(r){if(r.constructor&&"function"==typeof r.constructor.isBuffer)return r.constructor.isBuffer(r);return!1}(r))return"buffer";if(function(r){try{if("number"==typeof r.length&&"function"==typeof r.callee)return!0}catch(r){if(-1!==r.message.indexOf("callee"))return!0}return!1}(r))return"arguments";if(function(r){return r instanceof Date||"function"==typeof r.toDateString&&"function"==typeof r.getDate&&"function"==typeof r.setDate}(r))return"date";if(function(r){return r instanceof Error||"string"==typeof r.message&&r.constructor&&"number"==typeof r.constructor.stackTraceLimit}(r))return"error";if(function(r){return r instanceof RegExp||"string"==typeof r.flags&&"boolean"==typeof r.ignoreCase&&"boolean"==typeof r.multiline&&"boolean"==typeof r.global}(r))return"regexp";switch(a(r)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(r){return"function"==typeof r.throw&&"function"==typeof r.return&&"function"==typeof r.next}(r))return"generator";switch(t=e.call(r)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function a(r){return r.constructor?r.constructor.name:null}var o="@@__STRUCT__@@",i="@@__KIND__@@";function u(r){return!(!r||!r[o])}function s(r,t){return"function"==typeof r?r(t):r}var c=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r};class f{constructor(r,t,e){this.name=r,this.type=t,this.validate=e}}function v(r,t,e){if(u(r))return r[i];if(r instanceof f)return r;switch(n(r)){case"array":return r.length>1?m(r,t,e):y(r,t,e);case"function":return p(r,t,e);case"object":return l(r,t,e);case"string":var a=!0,o=void 0;if(r.endsWith("?")&&(a=!1,r=r.slice(0,-1)),r.includes("|"))o=w(r.split(/\s*\|\s*/g),t,e);else if(r.includes("&")){o=g(r.split(/\s*&\s*/g),t,e)}else o=b(r,t,e);return a||(o=h(o,void 0,e)),o}throw new Error(`A schema definition must be an object, array, string or function, but you passed: ${r}`)}function d(r,t,e){if("array"!==n(r))throw new Error(`Enum structs must be defined as an array, but you passed: ${r}`);var a=r.map(function(r){try{return JSON.stringify(r)}catch(t){return String(r)}}).join(" | ");return new f("enum",a,function(e=s(t)){return r.includes(e)?[void 0,e]:[{data:e,path:[],value:e,type:a}]})}function p(r,t,e){if("function"!==n(r))throw new Error(`Function structs must be defined as a function, but you passed: ${r}`);return new f("function","<function>",function(e=s(t),a){var o=r(e,a),i={path:[],reason:null},u=void 0;switch(n(o)){case"boolean":u=o;break;case"string":u=!1,i.reason=o;break;case"object":u=!1,i=c({},i,o);break;default:throw new Error(`Validator functions must return a boolean, an error reason string or an error reason object, but you passed: ${r}`)}return u?[void 0,e]:[c({type:"<function>",value:e,data:e},i)]})}function y(r,t,e){if("array"!==n(r)||1!==r.length)throw new Error(`List structs must be defined as an array with a single element, but you passed: ${r}`);var a=b("array",void 0,e),o=v(r[0],void 0,e),i=`[${o.type}]`;return new f("list",i,function(r=s(t)){var[e,n]=a.validate(r);if(e)return e.type=i,[e];r=n;for(var u=[],c=[],f=0;f<r.length;f++){var v=r[f],[d,p]=o.validate(v);d?(d.path=[f].concat(d.path),d.data=r,u.push(d)):c[f]=p}if(u.length){var y=u[0];return y.errors=u,[y]}return[void 0,c]})}function l(r,t,e){if("object"!==n(r))throw new Error(`Object structs must be defined as an object, but you passed: ${r}`);var a=b("object",void 0,e),o=[],i={};for(var u in r){o.push(u);var c=v(r[u],void 0,e);i[u]=c}var d=`{${o.join()}}`;return new f("object",d,function(r=s(t)){var[e]=a.validate(r);if(e)return e.type=d,[e];var n=[],o={},u=Object.keys(r),c=Object.keys(i);if(new Set(u.concat(c)).forEach(function(e){var a=r[e],u=i[e];if(void 0===a&&(a=s(t&&t[e],r)),u){var[c,f]=u.validate(a,r);if(c)return c.path=[e].concat(c.path),c.data=r,void n.push(c);(e in r||void 0!==f)&&(o[e]=f)}else{var v={data:r,path:[e],value:a};n.push(v)}}),n.length){var f=n[0];return f.errors=n,[f]}return[void 0,o]})}function h(r,t,e){return w([r,"undefined"],t,e)}function b(r,t,e){if("string"!==n(r))throw new Error(`Scalar structs must be defined as a string, but you passed: ${r}`);var{types:a}=e,o=a[r];if("function"!==n(o))throw new Error(`No struct validator function found for type "${r}".`);var i=p(o,t),u=r;return new f("scalar",u,function(r){var[t,e]=i.validate(r);return t?(t.type=u,[t]):[void 0,e]})}function m(r,t,e){if("array"!==n(r))throw new Error(`Tuple structs must be defined as an array, but you passed: ${r}`);var a=r.map(function(r){return v(r,void 0,e)}),o=b("array",void 0,e),i=`[${a.map(function(r){return r.type}).join()}]`;return new f("tuple",i,function(r=s(t)){var[e]=o.validate(r);if(e)return e.type=i,[e];for(var n=[],u=[],c=Math.max(r.length,a.length),f=0;f<c;f++){var v=a[f],d=r[f];if(v){var[p,y]=v.validate(d);p?(p.path=[f].concat(p.path),p.data=r,u.push(p)):n[f]=y}else{var l={data:r,path:[f],value:d};u.push(l)}}if(u.length){var h=u[0];return h.errors=u,[h]}return[void 0,n]})}function w(r,t,e){if("array"!==n(r))throw new Error(`Union structs must be defined as an array, but you passed: ${r}`);var a=r.map(function(r){return v(r,void 0,e)}),o=a.map(function(r){return r.type}).join(" | ");return new f("union",o,function(r=s(t)){var e=[];for(var n of a){var[i,u]=n.validate(r);if(!i)return[void 0,u];e.push(i)}return e[0].type=o,e})}function g(r,t,e){if("array"!==n(r))throw new Error(`Intersection structs must be defined as an array, but you passed: ${r}`);var a=r.map(function(r){return v(r,void 0,e)}),o=a.map(function(r){return r.type}).join(" & ");return new f("intersection",o,function(r=s(t)){var e=r;for(var n of a){var[i,u]=n.validate(e);if(i)return i.type=o,[i];e=u}return[void 0,e]})}var j={any:v,dict:function(r,t,e){if("array"!==n(r)||2!==r.length)throw new Error(`Dict structs must be defined as an array with two elements, but you passed: ${r}`);var a=b("object",void 0,e),o=v(r[0],void 0,e),i=v(r[1],void 0,e),u=`dict<${o.type},${i.type}>`;return new f("dict",u,function(r){var e=s(t);r=e?c({},e,r):r;var[n]=a.validate(r);if(n)return n.type=u,[n];var f={},v=[];for(var d in r){var p=r[d],[y,l]=o.validate(d);if(y)y.path=[d].concat(y.path),y.data=r,v.push(y);else{d=l;var[h,b]=i.validate(p);h?(h.path=[d].concat(h.path),h.data=r,v.push(h)):f[d]=b}}if(v.length){var m=v[0];return m.errors=v,[m]}return[void 0,f]})},enum:d,enums:function(r,t,e){return y([d(r,void 0)],t,e)},function:p,instance:function(r,t,e){var n=`instance<${r.name}>`;return new f("instance",n,function(e=s(t)){return e instanceof r?[void 0,e]:[{data:e,path:[],value:e,type:n}]})},interface:function(r,t,e){if("object"!==n(r))throw new Error(`Interface structs must be defined as an object, but you passed: ${r}`);var a=[],o={};for(var i in r){a.push(i);var u=v(r[i],void 0,e);o[i]=u}var d=`{${a.join()}}`;return new f("interface",d,function(r){var e=s(t),n=[],a=r=e?c({},e,r):r;for(var i in o){var u=r[i],f=o[i];void 0===u&&(u=s(t&&t[i],r));var[v,d]=f.validate(u,r);v?(v.path=[i].concat(v.path),v.data=r,n.push(v)):(i in r||void 0!==d)&&(a[i]=d)}if(n.length){var p=n[0];return p.errors=n,[p]}return[void 0,a]})},lazy:function(r,t,e){if("function"!==n(r))throw new Error(`Lazy structs must be defined as an function that returns a schema, but you passed: ${r}`);var a=void 0,o=void 0;return a=new f("lazy","lazy...",function(t){return o=r(),a.name=o.kind,a.type=o.type,a.validate=o.validate,a.validate(t)})},list:y,literal:function(r,t,e){var n=`literal: ${JSON.stringify(r)}`;return new f("literal",n,function(e=s(t)){return e===r?[void 0,e]:[{data:e,path:[],value:e,type:n}]})},object:l,optional:h,partial:function(r,t,e){if("object"!==n(r))throw new Error(`Partial structs must be defined as an object, but you passed: ${r}`);var a=b("object",void 0,e),o=[],i={};for(var u in r){o.push(u);var c=v(r[u],void 0,e);i[u]=c}var d=`{${o.join()},...}`;return new f("partial",d,function(r=s(t)){var[e]=a.validate(r);if(e)return e.type=d,[e];var n=[],o={};for(var u in i){var c=r[u],f=i[u];void 0===c&&(c=s(t&&t[u],r));var[v,p]=f.validate(c,r);v?(v.path=[u].concat(v.path),v.data=r,n.push(v)):(u in r||void 0!==p)&&(o[u]=p)}if(n.length){var y=n[0];return y.errors=n,[y]}return[void 0,o]})},scalar:b,tuple:m,union:w,intersection:g},E={any:function(r){return void 0!==r}};function $(r={}){var e=c({},E,r.types||{});function n(r,n,a={}){u(r)&&(r=r.schema);var s=j.any(r,n,c({},a,{types:e}));function f(r){if(this instanceof f)throw new Error("The `Struct` creation function should not be used with the `new` keyword.");return f.assert(r)}return Object.defineProperty(f,o,{value:!0}),Object.defineProperty(f,i,{value:s}),f.kind=s.name,f.type=s.type,f.schema=r,f.defaults=n,f.options=a,f.assert=function(r){var[e,n]=s.validate(r);if(e)throw new t(e);return n},f.test=function(r){var[t]=s.validate(r);return!t},f.validate=function(r){var[e,n]=s.validate(r);return e?[new t(e)]:[void 0,n]},f}return Object.keys(j).forEach(function(r){var t=j[r];n[r]=function(r,a,o){return n(t(r,a,c({},o,{types:e})),a,o)}}),n}["arguments","array","boolean","buffer","date","error","float32array","float64array","function","generatorfunction","int16array","int32array","int8array","map","null","number","object","promise","regexp","set","string","symbol","uint16array","uint32array","uint8array","uint8clampedarray","undefined","weakmap","weakset"].forEach(function(r){E[r]=function(t){return n(t)===r}});var k=$();r.struct=k,r.superstruct=$,r.isStruct=u,r.StructError=t,Object.defineProperty(r,"__esModule",{value:!0})});
